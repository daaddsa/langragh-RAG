# 5. 技术规范文档 (精简版)

## 1. 软件环境

### 1.1 开发环境
*   **OS**: Windows 10/11 或 macOS
*   **Python**: 3.10+
*   **IDE**: VS Code / PyCharm / Trae
*   **Git**: 2.30+

### 1.2 依赖库 (requirements.txt)
```text
fastapi==0.104.1
uvicorn==0.24.0
streamlit==1.28.2
langgraph==0.0.10
langchain-openai==0.0.2
langchain-community==0.0.10
tavily-python==0.3.0
reportlab==4.0.7
python-dotenv==1.0.0
aiosqlite==0.19.0
requests==2.31.0
```

## 2. 后端规范 (FastAPI)

### 2.1 代码结构
```
backend/
├── app/
│   ├── main.py          # FastAPI 应用入口
│   ├── graph.py         # LangGraph 逻辑定义
│   ├── schema.py        # Pydantic 模型定义
│   ├── pdf_service.py   # PDF 生成服务
│   └── utils.py         # 工具函数
└── .env                 # 环境变量 (不要提交到Git)
```

### 2.2 接口规范
*   遵循 RESTful 风格。
*   使用 Pydantic 进行请求体验证。
*   使用 `async def` 定义异步视图函数。

## 3. 前端规范 (Streamlit)

### 3.1 页面布局
使用 `st.set_page_config` 设置宽屏模式。
*   **Sidebar**: API Key 输入框、Session 重置按钮。
*   **Main Area**:
    *   Header: 项目标题。
    *   Chat Container: 使用 `st.chat_message` 渲染历史消息。
    *   Chat Input: `st.chat_input`。
    *   Export Button: 下载生成的 PDF。

### 3.2 状态管理
使用 `st.session_state` 管理前端状态：
*   `messages`: list, 本地显示的对话历史。
*   `session_id`: str, 当前会话的唯一标识。

## 4. 编码规范

### 4.1 命名规范
*   变量/函数：`snake_case` (如 `get_search_results`)
*   类名：`CamelCase` (如 `ResearchAgent`)
*   常量：`UPPER_CASE` (如 `DEFAULT_MODEL`)

### 4.2 注释
*   核心函数必须包含 Docstring，说明参数和返回值。
*   复杂逻辑（如 LangGraph 的 Conditional Edge）需添加行内注释。

## 5. 安全规范

*   **API Key**: 严禁硬编码。必须从环境变量或前端 Input 获取。
*   **Git**: 提交前检查 `.gitignore` 包含 `.env`, `__pycache__`, `*.pdf`, `*.sqlite`。
