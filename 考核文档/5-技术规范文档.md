# 5. 技术规范文档 (Technical Specifications)

## 1. 技术栈选型

### 1.1 编程语言
*   **Python 3.10+**: 考虑到 LangChain/LangGraph 对新特性的支持以及类型提示的完善。

### 1.2 核心框架
*   **Web 框架**: FastAPI (高性能，原生支持 Async/Await，适合 LLM 流式输出)。
*   **UI 框架**: Streamlit (极速构建数据应用，内置 Chat 组件)。
*   **Agent 编排**: LangGraph (基于图的状态机，比 LangChain Chain 更灵活)。
*   **PDF 引擎**: ReportLab (功能强大，虽然学习曲线稍陡，但对中文支持可控)。

### 1.3 外部服务
*   **LLM**: OpenAI API 协议兼容模型 (GPT-3.5, Qwen-Plus, DeepSeek-Chat)。
*   **Search**: Tavily API (专为 AI 设计的搜索引擎，返回 JSON 格式结果)。

## 2. 目录结构规范

```
project_root/
├── backend/                # 后端代码
│   ├── app/
│   │   ├── main.py         # FastAPI 入口
│   │   ├── graph.py        # LangGraph 定义
│   │   ├── state.py        # State 定义
│   │   ├── schema.py       # Pydantic 模型
│   │   └── pdf_service.py  # PDF 生成逻辑
│   └── assets/
│       └── simsun.ttc      # 字体文件
├── frontend/               # 前端代码
│   └── app.py              # Streamlit 入口
├── requirements.txt        # 依赖列表
└── README.md               # 项目说明
```

## 3. 代码规范

### 3.1 命名规范
*   **变量/函数**: `snake_case` (如 `generate_pdf`, `user_message`)。
*   **类名**: `PascalCase` (如 `AgentState`, `PDFRequest`)。
*   **常量**: `UPPER_CASE` (如 `API_BASE_URL`)。

### 3.2 异步编程
*   后端接口统一使用 `async def`。
*   涉及 IO 操作（如 API 调用）必须使用 `await`。
*   LangGraph 节点定义推荐使用 `async def` 以支持非阻塞并发。

### 3.3 类型提示
*   使用 Python `typing` 模块。
*   所有函数入参和返回值应尽量标注类型，方便 IDE 提示和 Pydantic 校验。

## 4. 异常处理规范
*   **API 层面**: 使用 `try-except` 捕获所有未处理异常，并返回 500 状态码及错误详情。
*   **流式传输**: 在 Generator 内部捕获异常，如果流已开始，则 Yield 错误信息给前端展示。
*   **前端**: 检查 `response.status_code`，非 200 时通过 `st.error` 弹窗提示。

## 5. 版本控制
*   使用 Git 进行版本管理。
*   不提交 `.env` 文件和 `__pycache__` 目录。
*   提交信息应清晰描述改动（如 "Fix: PDF generation font path issue"）。
